- hosts: localhost
  tasks:
  - name: Deploy the service
    k8s:
      state: present
      definition: 
        apiVersion: apps/v1
        kind: StatefulSet
        metadata:
          name: donkeybot
        spec:
          serviceName: donkeybot
          template:
            metadata:
              labels:
                app: donkeybot
            spec:
              containers:
              - image: "{{ image }}"
                name: donkeybot
                env:
                - name: MYSQL_HOST
                  value: mysql
                - name: MYSQL_PORT
                  value: "3306"
                volumeMounts:
                  - name: donkeybot-persistent-storage
                    mountPath: /discordbase/img_cache
              volumes:
                - name: donkeybot-persistent-storage
                  persistentVolumeClaim:
                    claimName: nfs-discordbot-pvc

          selector:
            matchLabels:
              app: donkeybot
      validate_certs: no
      namespace: discordbots
